# üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "database is locked"

## –ü—Ä–æ–±–ª–µ–º–∞:
```
ERROR:__main__:‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: database is locked
```

–ë–æ—Ç –ø–∞–¥–∞–µ—Ç –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏–∑-–∑–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö session —Ñ–∞–π–ª–∞.

---

## ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –æ—á–∏—Å—Ç–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏:

```bash
cd /opt/reklama_bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±–æ—Ç–∞
pkill -9 -f "python3 main.py"
pkill -9 -f "main.py"

# –ü–æ–¥–æ–∂–¥–∞—Ç—å
sleep 3

# –£–¥–∞–ª–∏—Ç—å lock —Ñ–∞–π–ª—ã
rm -f *.session-journal
rm -f *.session-wal

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö
lsof -i :5000 -i :5001 2>/dev/null || echo "–ü–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã"

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ—Ä—Ç–∞—Ö (–µ—Å–ª–∏ –µ—Å—Ç—å)
fuser -k 5000/tcp 5001/tcp 2>/dev/null

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ
sleep 2

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
ps aux | grep "main.py" | grep -v grep || echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç:

```bash
cd /opt/reklama_bot
nohup python3 main.py > bot.log 2>&1 &

# –ü–æ–¥–æ–∂–¥–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
sleep 5
tail -30 bot.log
```

---

## üîÑ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å session —Ñ–∞–π–ª

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!

```bash
cd /opt/reklama_bot

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp *.session* session_backup_$(date +%Y%m%d_%H%M%S)/ 2>/dev/null || mkdir session_backup

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç
pkill -9 -f "python3 main.py"
sleep 2

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã
rm -f *.session-journal
rm -f *.session-wal

# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å session —Ñ–∞–π–ª (–¥–ª—è –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è)
mv session_name.session session_name.session.old 2>/dev/null

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å - –±–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—ã–π session —Ñ–∞–π–ª
nohup python3 main.py > bot.log 2>&1 &
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–ª—É—á—à–∏—Ç—å –∫–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏

–î–æ–±–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
cd /opt/reklama_bot

# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep python | grep main

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å lock —Ñ–∞–π–ª—ã
ls -lh *.session* 2>/dev/null

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç session —Ñ–∞–π–ª
lsof *.session 2>/dev/null

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -50 bot.log | grep -E "locked|error|ERROR"
```

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:

–°–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 1 (–æ—á–∏—Å—Ç–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫) - —ç—Ç–æ –æ–±—ã—á–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É.

–ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–∂–µ—Ç - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 2 (–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ session —Ñ–∞–π–ª–∞), –Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∑–∞–Ω–æ–≤–æ.

